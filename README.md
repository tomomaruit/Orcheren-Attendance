# Orcheren-Attendance
Googleフォームの回答を楽器パート順に自動整理するGoogle Apps Script。重複する回答者の最新データのみを保持し、指定したパート順に並び替えて表示します。

## 機能

- 📝 Googleフォーム回答の自動整理
- 🎵 楽器パート順での並び替え
- 🔄 重複回答者の最新データのみ保持
- ⚡ フォーム送信時の自動実行
- 📊 専用シートへの整理済み結果出力

## セットアップ

### 1. スプレッドシートの準備

1. Googleフォームに接続されたスプレッドシートを開く
2. フォーム回答シートの名前が「フォームの回答 1」であることを確認
3. 回答データの列構成を確認：
   - A列: タイムスタンプ
   - B列: 名前
   - C列: パート（楽器）
   - D列: その他の回答データ
   - E列: その他の回答データ
   - F列: その他の回答データ

### 2. スクリプトの導入

1. スプレッドシートで「拡張機能」→「Apps Script」を選択
2. 提供されたコードをコピー&ペースト
3. プロジェクトを保存

### 3. 初回設定

1. スプレッドシートを開くとメニューバーに「回答整理」が表示される
2. 「回答整理」→「【初回1回だけやる】自動実行トリガーを設定」を選択
3. 必要な権限を許可

## 使用方法

### 自動実行
フォームが送信されるたびに、自動的に回答が整理され「整理済み回答」シートに出力されます。

### 手動実行
「回答整理」→「最新の回答をパート順に整理」を選択して手動実行も可能です。

## パート順の設定

コード内の`partOrder`配列を変更することで並び替え順序を変更できます：

```javascript
const partOrder = ['Fl', 'Ob', 'Cl', 'Fg', 'Tp', 'Tb', 'Hr', 'Tu', 'Per', 'Vn', 'Vla', 'Vc', 'Cb'];
```

### デフォルトパート順
1. Fl (フルート)
2. Ob (オーボエ)
3. Cl (クラリネット)
4. Fg (ファゴット)
5. Tp (トランペット)
6. Tb (トロンボーン)
7. Hr (ホルン)
8. Tu (チューバ)
9. Per (パーカッション)
10. Vn (バイオリン)
11. Vla (ビオラ)
12. Vc (チェロ)
13. Cb (コントラバス)

※ リストにない楽器（特殊楽器等）は最後に表示されます

## 整理ルール

- **重複排除**: 同じ名前の回答者の場合、最新のタイムスタンプの回答のみ保持
- **並び替え**: 指定されたパート順に自動ソート
- **出力**: 「整理済み回答」シートに結果を表示
- **書式設定**: タイムスタンプ列の日時形式設定、列幅の自動調整

## カスタマイズ

### シート名の変更
コード内の以下の変数を修正：
```javascript
const sourceSheetName = 'フォームの回答 1'; // 元データのシート名、GoogleFormの仕様に依存
const outputSheetName = '整理済み回答';   // 出力先のシート名
```

### データ範囲の変更
```javascript
const dataRange = sourceSheet.getRange('A2:F199'); // 取得範囲を調整
```

### 列幅の調整
```javascript
outputSheet.setColumnWidths(1, 6, 150); // 列数・幅を調整
```

## 機能詳細

- **onOpen()**: スプレッドシート開時にカスタムメニューを追加
- **setupTrigger()**: フォーム送信時の自動実行トリガーを設定
- **organizeResponses()**: 回答整理のメイン処理

## 注意事項

- フォーム回答シート名は「フォームの回答 1」である必要があります
- 名前列（B列）は重複チェックのキーとして使用されます
- パート列（C列）の値は`partOrder`配列の値と一致する必要があります
- トリガー設定は初回のみ実行してください（重複設定を避けるため）

## トラブルシューティング

### シートが見つからないエラー
- フォーム回答シートの名前を確認
- `sourceSheetName`変数を正しいシート名に変更

### 自動実行されない
- トリガー設定を再実行
- Apps Scriptの実行権限を確認

### パート順が正しくない
- `partOrder`配列の順序を確認
- フォーム回答のパート名とスクリプトの設定が一致するかチェック

## ライセンス

MIT License
